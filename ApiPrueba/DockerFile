FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /src

# Copia los archivos de proyecto (.csproj) y restáuralos
COPY ["ApiPrueba/ApiPrueba.csproj", "ApiPrueba/"]
RUN dotnet restore "ApiPrueba/ApiPrueba.csproj"

# Copia el resto del código
COPY . .

# Compila y publica la aplicación. Salida en /app/publish
RUN dotnet publish "ApiPrueba/ApiPrueba.csproj" -c Release -o /app/publish --no-restore

# ====================================================================
# STAGE 2: EJECUCIÓN (FINAL)
# Usamos la imagen ASP.NET (más ligera) para ejecutar.
# ====================================================================
FROM mcr.microsoft.com/dotnet/aspnet:8.0 AS final 
WORKDIR /app

# Copia los archivos publicados del Stage 1
COPY --from=build /app/publish .

# Define el puerto que usa ASP.NET Core
EXPOSE 80

# Comando para iniciar la aplicación (Asegúrate que el nombre de la DLL sea correcto)
ENTRYPOINT ["dotnet", "ApiPrueba.dll"]